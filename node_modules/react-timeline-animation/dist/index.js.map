{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\n\ninterface TimelineObserverProps {\n  handleObserve?: (\n    observer: (target: Element, callbackFn?: () => void) => void\n  ) => JSX.Element;\n\n  initialColor?: string;\n  fillColor?: string;\n  hasReverse?: boolean;\n}\n\nlet halfScreenHeight;\nif (typeof window !== \"undefined\") {\n  halfScreenHeight = window?.innerHeight / 2;\n}\n\nconst options = {\n  root: null,\n  rootMargin: \"0px\",\n  threshold: 0.2,\n};\n\ninterface ObservablesProps {\n  observable: IntersectionObserverEntry;\n  isPassed: boolean;\n  callbackFn?: () => void;\n}\n\nfunction setObservable({ obs, observableList, callbacks }) {\n  const obsId = obs?.target?.id;\n\n  if (!observableList.has(obsId)) {\n    observableList.set(obsId, {\n      observable: obs,\n      isPassed: false,\n      callbackFn: callbacks[obsId] || null,\n    });\n  }\n}\n\nfunction removeObservable({ obs, observableList }) {\n  const obsName = obs?.target?.id;\n\n  if (observableList.has(obsName)) {\n    observableList.set(obsName, {\n      ...observableList.get(obsName),\n      isPassed: true,\n    });\n  }\n}\n\nfunction colorize({ observableList, initialColor, fillColor, hasReverse }) {\n  observableList.forEach((observable) => {\n    if (!observable.isPassed) {\n      const rect = observable.observable.target.getBoundingClientRect();\n      const entry = observable?.observable;\n\n      if (rect.bottom > halfScreenHeight && rect.top < halfScreenHeight) {\n        if (initialColor && fillColor) {\n          const depthPx = rect.bottom - halfScreenHeight;\n          const depthPercent = (depthPx * 100) / rect.height;\n          entry.target.style.background = `linear-gradient(to top, ${initialColor} ${depthPercent}%, ${fillColor} ${depthPercent}% 100%)`;\n          entry.target.style.transform = \"translateZ(0)\";\n        }\n      }\n\n      if (rect.bottom < halfScreenHeight) {\n        if (initialColor && fillColor) {\n          entry.target.style.background = fillColor;\n          entry.target.style.transform = \"unset\";\n        }\n\n        if (observable?.callbackFn) {\n          if (!observable?.callbackFired) {\n            observable?.callbackFn();\n\n            observable.callbackFired = true;\n          }\n        }\n\n        if (!hasReverse) {\n          removeObservable({\n            obs: entry,\n            observableList,\n          });\n        }\n      }\n\n      if (rect.top > halfScreenHeight && hasReverse) {\n        entry.target.style.background = initialColor;\n      }\n    }\n  });\n}\n\nconst TimelineObserver = ({\n  handleObserve,\n  initialColor,\n  fillColor,\n  hasReverse,\n}: TimelineObserverProps) => {\n  const observablesStore = useRef(new Map<string, ObservablesProps>());\n  const callbacks = useRef<{ [key: string]: () => void }>({});\n\n  const callback = (entries) => {\n    entries?.forEach((entry) => {\n      if (entry.isIntersecting) {\n        setObservable({\n          obs: entry,\n          observableList: observablesStore.current,\n          callbacks: callbacks.current,\n        });\n      }\n    });\n  };\n  const observer = useRef(new IntersectionObserver(callback, options));\n\n  const animation = () => {\n    window.requestAnimationFrame(() => {\n      colorize({\n        observableList: observablesStore.current,\n        initialColor,\n        fillColor,\n        hasReverse,\n      });\n    });\n  };\n\n  useEffect(() => {\n    document.addEventListener(\"scroll\", animation);\n    return () => {\n      document.removeEventListener(\"scroll\", animation);\n    };\n  }, []);\n\n  const setObserver = (elem: HTMLElement, callbackFn?: () => void) => {\n    const elemId = elem?.id;\n\n    if (initialColor) {\n      elem.style.background = initialColor;\n    }\n\n    observer.current.observe(elem);\n\n    if (elemId && callbackFn) {\n      callbacks.current[elemId] = callbackFn;\n    }\n  };\n\n  return <div>{handleObserve ? handleObserve(setObserver) : null}</div>;\n};\n\nexport default TimelineObserver;\n"],"names":["useRef","useEffect","React"],"mappings":"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"}